<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAK ARTCC Training Session Monitor - Status</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='status-page.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='auth.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="nav-brand">üè¢ leftos.dev Dashboard</a>
            <div class="nav-links">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('auth.dashboard') }}">Dashboard</a>
                    <a href="{{ url_for('auth.logout') }}">Logout ({{ current_user.email }})</a>
                {% else %}
                    <a href="{{ url_for('auth.login') }}">Login</a>
                    <a href="{{ url_for('auth.register') }}">Register</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container">
        <header>
            <div class="header-nav">
                <a href="{{ url_for('index') }}" class="back-btn">‚Üê Back to Dashboard</a>
            </div>
            <h1>üéì OAK ARTCC Training Session Monitor</h1>
            <p>Monitor new training sessions for your selected ratings</p>
        </header>

        <main>

            <!-- Training Sessions Information -->
            <section class="controllers-section">
                <div class="controllers-grid">
                    <!-- Current Sessions -->
                    <div class="controller-card">
                        <h3>üìÖ Current Sessions</h3>
                        <div id="current-sessions" class="controller-list">
                            <div class="loading-placeholder">
                                <div class="loading"></div>
                                <span>Loading training sessions...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Monitored Ratings -->
                    <div class="controller-card">
                        <h3>üéØ Monitored Ratings</h3>
                        <div id="monitored-ratings" class="controller-list">
                            <div class="loading-placeholder">
                                <div class="loading"></div>
                                <span>Loading monitored ratings...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Settings -->
                    <div class="controller-card">
                        <h3>üîî Notifications Settings</h3>
                        <div id="notifications-settings" class="controller-list">
                            {% if current_user.is_authenticated %}
                                <div class="setting-item">
                                    <div class="setting-label">Training Session Notifications:</div>
                                    <div class="setting-value {{ 'status-enabled' if notifications_enabled else 'status-disabled' }}">
                                        {{ 'Enabled' if notifications_enabled else 'Disabled' }}
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">Pushover Configuration:</div>
                                    <div class="setting-value {{ 'status-enabled' if pushover_configured else 'status-disabled' }}">
                                        {{ 'Configured' if pushover_configured else 'Not Configured' }}
                                    </div>
                                </div>
                                {% if not notifications_enabled or not pushover_configured %}
                                    <div class="setting-help">
                                        <small>
                                            {% if not notifications_enabled %}
                                                Enable notifications in <a href="{{ url_for('auth.training_session_settings') }}">Training Session Settings</a>
                                            {% endif %}
                                            {% if not pushover_configured %}
                                                Configure Pushover in <a href="{{ url_for('auth.general_settings') }}">General Settings</a>
                                            {% endif %}
                                        </small>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="auth-required">
                                    <p><a href="{{ url_for('auth.login') }}">Login</a> to view notification settings</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </section>

            <!-- Service Information -->
            <section class="info-section">
                <div class="info-grid">
                    <div class="info-card">
                        <h3>üìä Service Stats</h3>
                        <div class="stats-list">
                            <div class="stat-item">
                                <span class="stat-label">Monitoring Status:</span>
                                <span class="stat-value" id="monitoring-status">Unknown</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Check Interval:</span>
                                <span class="stat-value" id="check-interval">1 hour</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Session Key Status:</span>
                                <span class="stat-value" id="session-key-status">Unknown</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>üîß Actions</h3>
                        <div class="actions-list">
                            {% if current_user.is_authenticated %}
                                <a href="{{ url_for('auth.training_session_settings') }}" class="btn btn-secondary">
                                    ‚öôÔ∏è Configure Settings
                                </a>
                            {% endif %}
                            <button id="test-notification-btn" class="btn btn-success">
                                <span id="test-notification-text">üîî Test Notification</span>
                            </button>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>‚ÑπÔ∏è About</h3>
                        <p>This service monitors OAK ARTCC training sessions and sends notifications when new sessions matching your selected ratings are scheduled. Sessions are checked hourly and notifications are sent via Pushover when new matches are found.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 OAK ARTCC Training Session Monitor</p>
        </footer>
    </div>

    <!-- First Visit Modal -->
    <div id="firstVisitModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" id="modalCloseBtn" aria-label="Close modal">&times;</button>
            <div class="modal-header">
                <div class="modal-icon">üéì</div>
                <h2>Welcome to OAK ARTCC Training Session Monitor!</h2>
            </div>
            <div class="modal-body">
                <p>This service monitors training sessions on the OAK ARTCC website and sends notifications for new sessions matching your selected ratings.</p>
                
                <div class="highlight">
                    <strong>Getting Started:</strong><br>
                    To receive notifications, you'll need to:
                    <ol>
                        <li>Configure your PHP session key from oakartcc.org</li>
                        <li>Select which ratings you want to monitor</li>
                        <li>Ensure you have Pushover configured in your dashboard</li>
                    </ol>
                </div>
                
                <p id="authMessage">
                    <!-- This will be populated by JavaScript based on auth status -->
                </p>
            </div>
            <div class="modal-actions" id="modalActions">
                <!-- Buttons will be populated by JavaScript based on auth status -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='training-status-page.js') }}"></script>
    
    <style>
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-weight: 600;
            color: #374151;
        }
        
        .setting-value {
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .setting-value.status-enabled {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .setting-value.status-disabled {
            background-color: #fed7d7;
            color: #9b2c2c;
        }
        
        .setting-help {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f3f4f6;
        }
        
        .setting-help small {
            color: #6b7280;
            line-height: 1.5;
        }
        
        .setting-help a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .setting-help a:hover {
            text-decoration: underline;
        }
        
        .auth-required {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .auth-required a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }
        
        .auth-required a:hover {
            text-decoration: underline;
        }
    </style>
</body>
</html>